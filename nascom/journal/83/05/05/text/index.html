<!doctype html>
<html lang="de">

<!-- navi-head.php / $Date: 2023-03-11 15:22:20 +0100 (Sa, 11. Mrz 2023) $ -->
<head>
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<meta charset="utf-8">

	<link rel="shortcut icon" type="image/x-icon" href="../../../../../../nascom/nascom.ico">
	<link rel="icon" type="image/png" href="../../../../../../nascom/apple-touch-icon.png" sizes="32x32">
	<link rel="icon" type="image/png" href="../../../../../../nascom/apple-touch-icon.png" sizes="96x96">
	<link rel="apple-touch-icon" sizes="180x180" href="../../../../../../nascom/apple-touch-icon.png">

	<!--bootstrap-->
	<link rel="stylesheet" href="../../../../../../cdn/bootstrap/css/bootstrap.min.css">

	<!--font awesome-->
	<link rel="stylesheet" href="../../../../../../cdn/fontawesome/css/fontawesome.min.css">
	<link rel="stylesheet" href="../../../../../../cdn/fontawesome/css/solid.min.css">

	<link rel="stylesheet" type="text/css" href="../../../../../../style.css">
<!-- /navi-head.php -->

	<!-- page.php / $Date: 2024-07-13 18:55:41 +0200 (Sa, 13. Jul 2024) $ -->

	<title>80-Bus Journal - Mai 1983 - Ausgabe 5</title>
	<!-- Sun, 15 Dec 2024 13:33:24 GMT -->
	<meta name="keywords" content="80-Bus Journal, Nascom Computer, Nascom 1, Nascom 2">
<!-- navi-body.php -->
</head>

<body>
	<nav class="navbar navbar-expand-md navbar-light bg-light style-navbar-top" id="top">
	<div class="container-fluid">
		<a class="navbar-brand" href="https://jloh.de/">
			<img src="../../../../../../favicon.ico" width="32" height="32" alt="JL" title="Homepage von Jürgen Loh">
		</a>
		<button
			class="navbar-toggler"
			type="button"
			data-bs-toggle="collapse"
			data-bs-target="#navbarSupportedContent"
			aria-controls="navbarSupportedContent"
			aria-expanded="false"
			aria-label="Toggle navigation"
		>
			<span class="navbar-toggler-icon"></span>
		</button>
		<div class="collapse navbar-collapse robots-nocontent" id="navbarSupportedContent">
			<ul class="navbar-nav md-auto">
				<li class="nav-item">
					<a class="nav-link" href="../../../../../../z80-kit/">Z80-KIT</a>
				</li>
				<li class="nav-item">
					<a class="nav-link" href="../../../../../../nascom/1/">Nascom 1</a>
				</li>
				<li class="nav-item">
					<a class="nav-link active" href="../../../../../../nascom/">Nascom Journal</a>
				</li>
				<li class="nav-item">
					<a class="nav-link" href="../../../../../../nascom/magazines/issues/">Nascom Magazines</a>
				</li>
				<li class="nav-item">
					<a class="nav-link" href="../../../../../../pico/">PICO</a>
				</li>
				<li class="nav-item">
					<a class="nav-link" href="../../../../../../cpm-plus/">CP/M</a>
				</li>
				<li class="nav-item">
					<a class="nav-link" href="../../../../../../">Tupel BBS</a>
				</li>
			</ul>
		</div>
	</div>
	</nav>

	<div class="container" style="max-width: 750px; color: #000; padding: 0 15px 0; background-color: #FFF">

<!--********************************************************************************-->

<!-- /navi-body.php / $Date: 2024-12-15 14:31:39 +0100 (So, 15. Dez 2024) $ -->
<table class="style-table-zeropadding" style="width: 100%">
	<tr>
		<td>
			<h1 class="h1Navi">80-Bus Journal</h1>
		</td>
		<td>&nbsp;&nbsp;</td>
		<td style="vertical-align:top">
			<h2 class="h2Navi"><span class="nowrap">Mai 1983</span> &middot; <span class="nowrap">Ausgabe 5</span></h2>
		</td>
	</tr>
</table>

<div id="head"><!-- Navigation oben -->
<table class="robots-nocontent style-table-zeropadding" style="width: 100%">
	<tr>
		<td class="navi-button">
			<a style="display: block" href="../../04/text/" title="Seite zurück"><span class="mirror-horizontal fas fa-play" aria-hidden=true></span></a>
		</td>
		<td class="navi-button">
			<a style="display: block" href="../../01/text/" title="Erste Seite"><span class="mirror-horizontal fas fa-fast-forward" aria-hidden=true></span></a>
		</td>
		<td class="navi-button">
			<a style="display: block" href="../../../../83/04/01/text/" title="Heft zurück"><span class="mirror-horizontal fas fa-forward" aria-hidden=true></span></a>
		</td>
		<th class="navi-button">
			<a style="display: block" href="../../text/" title="Inhaltsverzeichnis">Seite 5 von 28</a>
		</th>
		<td class="navi-button">
			<a style="display: block" href="../../../../83/06/01/text/" title="Heft vor"><span class="fas fa-forward" aria-hidden=true></span></a>
		</td>
		<td class="navi-button">
			<a style="display: block" href="../../28/text/" title="Letzte Seite"><span class="fas fa-fast-forward" aria-hidden=true></span></a>
		</td>
		<td class="navi-button">
			<a style="display: block" href="../../06/text/" title="Seite vor"><span class="fas fa-play" aria-hidden=true></span></a>
		</td>
	</tr>
</table>
</div><!-- /Navigation oben -->

<!-- Die Seite -->
<div class="row" id="page"><div class="col-sm-12 hyphenate" style="border: 1px solid #000; padding-top: 1em; padding-bottom: 1em;">

<!-- 2(2) Spalten im Blocksatz: Start --><div class="style-multi-column-2 justify">

<h1 id="article1">
BLS Auto Init
</h1>
<h3>
von Jürgen Weiermann
</h3>
<p>
Die Idee der frei definierbaren Drucker-Schnittstelle beim
<span class="uppercase"><!-- External Link --><a href="https://de.wikipedia.org/wiki/Turbo_Pascal#Geschichte" title="Externer Link: Blue Label Software Pascal" target="_blank" rel="noreferrer">BLS-Pascal</a><!-- /External Link -->
</span>
hat sicherlich ihre Vorteile, wenn man bedenkt, wie viele verschiedene
Drucker und somit auch verschiedene Schnittstellen es zur Zeit auf dem
Markt gibt; ja es ist sicherlich ein &bdquo;Muß&ldquo; für den 
Software-Anbieter, dem Anwender so viel Freiraun zu lassen. Doch hat
diese Idee auch einen kleinen Nachteil, den ich mit diesem Artikel zu
beheben versuche. Anwender dieser Pascal-Version werden es sicherlich
schon als störend empfunden haben, wenn es einmal vergessen wurde, vor
dem Initialisieren des
<span class="uppercase"><!-- External Link --><a href="https://de.wikipedia.org/wiki/Turbo_Pascal#Geschichte" title="Externer Link: Blue Label Software Pascal" target="_blank" rel="noreferrer">BLS-Pascal</a><!-- /External Link -->
</span>
die Druckerroutine einzutippen
und/&#x200b;oder den Einsprungvektor für die Druckerroutine zu ändern. Dann
darf man erst ein mal über Umwege sein Versäumnis nachholen. Sollte man
einmal aus Versehen die RESET-Taste gedrückt haben, darf man von neuem
die Stelle 0C78H ändern. Diese lästige Begleiterscheinung der
wohlgepriesenen Flexibilität des Systems kann man auf sehr einfache Art
und Weise beseitigen, man muß nur den Punkt im Programm finden, an dem
es zur Druckerroutine springt. Es erschien mir als überaus trickreich
(so dachte ich damals), an den Anfang des Druckerprogramms den Befehl
BRKPT RST 20H zu setzen, um dann zusammen mit NASDIS den Stack nach der
Rücksprungadresse abzusuchen. Diese Methode erwies sich als krasser
Denkfehler, denn nicht Pascal sprang zur Routine sondern Nas-sys, was
mir auch sofort einleuchtet, denn müßte man sonst den Sprung $UOUT
(Benutzer-Ausgabe-Programm) ändern? Nun ja, die Idee zu dem zweiten
Versuch lag an dieser Stelle sehr nahe.&#x200b;Irgendwie mußte ja schliesslich
auch Nas-Sys den Weg zurück finden, also untersuchte ich weiterhin den
Stack nach Adressen, die mir sinnvoll erschienen. Doch fand ich derer
mehr, als ich erwartet hatte, und alle hatten irgend etwas mit
Zeichen-Ein/&#x200b;Ausgabe zu tun. Weiterhelfen konnte mir da nur noch das
Assembler-Listing (Bravo, Sie haben&rsquo;s disassembliert!&nbsp;&ndash; Können Sie der
Redaktion und Herrn Bach eine Kopie zur Verfügung stellen?) und eine
genaue Lektüre der betroffenen Programmstellen. (Uebrigens, für
denjenigen, den es interessiert: für das Ass.-Listing hat mein MX 80 FT
immerhin geschlagene 2 1/4 Stunden gebraucht, bei einer
Uebertragungsrate von 19200 Baud mit 101 Seiten Ausdruck (Der Druckkopf
war nach diesem Non-Stop Einsatz gut warm, aber nicht heiss.)). Um es
nun kurz zu machen, es fand sich sehr bald die Stelle, an der der
Editor mit dem Monitor-Unterprogramm NOM (DF 71H) die Ausgabe-Tabelle
änderte und somit dafür sorgte, daß Nas-Sys die von Benutzer gelieferte
Ausgaberoutine benutzt. (Diese neue Tabelle zeigt dann auf E710H mit
den Werten 75H für UOUT und 00 für Tabellen-Ende. Ab der Adresse E727H,
wo eigentlich der Aufruf von NOM und INC DE steht, habe ich nun einen
CALL eingebaut, der das Programm veranlaßt, zu einem noch freien
Bereich des Pascal-Compilers zu springen(E157H&nbsp;&ndash; E17D). Uebrigens:
wußten Sie schon, daß bei den Adressen E17EH und E17FH die Seriennummer
Ihres Pascal&rsquo;s zu finden ist? (&hellip;zensiert&hellip;RED)
</p>
<p>
Zurueck zum Thema. An diesen eben aufgeführten Stellen kann man nun
bequem seine Erweiterung einschieben. Ab der Adresse E158 steht nun der
Abschnitt AUTO-INIT, der erstens dafür sorgt, daß die zuvor
gestrichenen Befehle NOM und INC DE nachgeholt werden, und dann wird
eine Änderung des Vektors für die Ausgabe(Drucker)-Routine vorgekommen.
Ab der Adresse E162H steht dann ein Programm zur Ansteuerung des
Druckers. Im Ass.-Listing finden Sie ein Programm, welches einen
Drucker über den vom Monitor unterstützten seriellen Port ansteuert.
Man beachte, daß anders als ZEAP das Pascal-System kein Line-Feed
ausgibt und dies noch in Drucker-Programm erledigt werden muß. Sollte
jemand von Ihnen bei der Änderung Probleme haben, bin ich gerne bereit,
weiterzuhelfen; vor allem denke ich an diejenigen, die keinen Prommer
haben (bitte Rückporto und Angaben über die Druckerroutine bei legen
(ich kann nur
<!-- External Link --><a href="https://ece-classes.usc.edu/ee459/library/datasheets/2716.pdf" title="Externer Link" target="_blank" rel="noreferrer">2716</a><!-- /External Link -->
programmieren)).
</p>
<p>
Hier noch etwas, was man auf jeden Fall wissen muß, was aber nicht im
Manual erwähnt wird: sollte man aus Gründen der Anpassung an die eigene
Drucker-Routine das Line-Feed-Problem softwaremäßig lösen wollen, so
ist der Befehl in Zeile 280 unbedingt notwendig, da sonst der
Print-Befehl mit &sbquo;Control "P,"L&lsquo; die erwünschte
Zeilennummerierung nur in der ersten Zeile zustande bringt. Als mir
dies widerfuhr, dachte ich zuerst, eines der anderen Register, welches
vielleicht als Zähler benutzt wird, würde von meiner Routine verändert.
Ein Test der Routine DF 6F mit NAS-DIS zeigte mir aber schließlich das,
was ich erwartet

<!-- 2 Spalten im Blocksatz: Spaltenwechsel -->

hatte: es werden keine Register durch diese Routine verändert. Wie
schon weiter oben erwähnt wurde, war ein Test der gesamten
Drucker-Routine in Verbindung mit den Pascal-Compiler nicht möglich,
also blieb mir nur noch das Absuchen des Assembler-Listings als einzige
Alternative.
</p>
<p>
An dieser Stelle möchte ich gerne eine Frage an unsere
NAS-SYS-Spezialisten stellen: gegeben sei Folgendes &mdash; das Programm (in
diesem Fall wäre es der Pascal-Compiler) ändert mit dem Befehl NOM (&nbsp;DF
71&nbsp;) die Adresse der Ausgabe-Tabelle. In der neuen Tabelle wird dann
die Ausgabe-Routine UOUT (75H) eingetragen. Wird nun im Laufe des
Programms ein Zeichen mit dem Befehl ROUT (RST 30H) ausgegeben, so
springt das Programm bei Erreichen dieses Befehls zu
&bdquo;NAS-SYS&ldquo; mit dem Zeichen im A-Register. Von dort geht es
dann zur Adresse 0C77H, wo ein Sprung zur Benutzer-Routine steht. Und
nun die Frage: Warum ist es nicht möglich, in der Benutzer-Routine
einen Befehl wie z.B. BRKPT (RST 20H) oder MRET (DF 5B) zur Ausführung
zu bringen, damit man eventuell zu Anfang und zum Ende die Register
testen kann? Mir ist es auch unter noch so großen Bemühungen nicht
gelungen, meinen Nascom zu bewegen, mir an den wichtigen Stellen die
Register zu zeigen. Ich hoffe es kann mir hier jemand weiterhelfen.
</p>
<p>
(Anmerkung der Redaktion: Der Grund, warum die Registeranzeige in einem
Ausgabeprogramm nicht funktioniert, ist ganz einfach: Auch die
Registeranzeige ruft ebenfalls dasselbe Ausgabeprogramm auf, das
untersucht werden soll, um eben die Register anzuzeigen. Dann läuft das
Programm immer wieder auf den Breakpoint auf; es kommt also gar nicht
zur Anzeige der Register. Bei NAS-SYS-3 wurde auch das verbessert,
jedenfalls kann ich damit durch meine Druckerroutine
&bdquo;Singlesteppen&ldquo;. Vermutlich wird der RST-Befehl E7 erst nach
der Registeranzeige wieder zurückgeschrieben. GK)
</p>
<p>
Im Assembler-Listing fand ich nach langem Suchen bei der Adresse E742H
die entscheidende Stelle, wo mit den Befehl RST 30H ein Zeichen
ausgegeben wurde. Erst nachdem das Zeichen über die vom Benutzer
definierte Schnittstelle ausgegeben wurde, erfolgte der Vergleich, ob
das im Register A stehende Zeichen ein CR war. Erfolgt ein Zero bei
diesem Vergleich, so springt das Prgramm zu einem Unterprogramm, mit
welchem die Zeilennummer generiert und ausgegeben wird. Analog dazu
steht dann folgendes: kehrt das Programm mit LF (0AH) aus der Routine
zurück, so heißt das für dieses, daß noch nicht alle Zeichen der Zeile
gedruckt wurden, und es fährt mit der Ausgabe fort, bis der
END-BLOCK-MARKER kommt. Bei dieser Untersuchung endeckte ich dann auch
die Speicherstelle, in der die Zeilennummer zwischengespeichert wird.
Da man sie für eventuelle Manipulationen gebrauchen kann, soll ihre
Adresse auch nicht verschwiegen werden: (0C91H).
</p>

<!-- Kasten über ganze Spalte: Start --><div style="border-style: solid; padding: 10px; border-width: 2px;  width: 100%; ">
<img class="img-fluid mx-auto d-block " src="../../Image-05-1.jpeg" alt="" width="193" height="336">
<!-- Kasten: Ende --></div>

<!-- 2 Spalten: Ende --></div>

</div></div>
<!-- /Die Seite -->

<!-- Navigation unten -->
<table class="robots-nocontent style-table-zeropadding" style="width: 100%">
	<tr>
		<td class="navi-button">
			<a style="display: block" href="../../04/text/" title="Seite zurück"><span class="mirror-horizontal fas fa-play" aria-hidden=true></span></a>
		</td>
		<td class="navi-button">
			<a style="display: block" href="../../01/text/" title="Erste Seite"><span class="mirror-horizontal fas fa-fast-forward" aria-hidden=true></span></a>
		</td>
		<td class="navi-button">
			<a style="display: block" href="../../../../83/04/01/text/" title="Heft zurück"><span class="mirror-horizontal fas fa-forward" aria-hidden=true></span></a>
		</td>
		<th class="navi-button">
			<a style="display: block" href="../../text/" title="Inhaltsverzeichnis">Seite 5 von 28</a>
		</th>
		<td class="navi-button">
			<a style="display: block" href="../../../../83/06/01/text/" title="Heft vor"><span class="fas fa-forward" aria-hidden=true></span></a>
		</td>
		<td class="navi-button">
			<a style="display: block" href="../../28/text/" title="Letzte Seite"><span class="fas fa-fast-forward" aria-hidden=true></span></a>
		</td>
		<td class="navi-button">
			<a style="display: block" href="../../06/text/" title="Seite vor"><span class="fas fa-play" aria-hidden=true></span></a>
		</td>
	</tr>
</table>
<!-- /Navigation unten -->

<!-- navi-footer.php / $Date: 2023-03-11 15:22:20 +0100 (Sa, 11. Mrz 2023) $ -->

<!--********************************************************************************-->

	</div>

	<nav class="nav flex-column flex-md-row style-navbar-bottom robots-nocontent"> <!--nav-pills-->
		<a class="sm-fill nav-link" href="#top"><span title="Nach oben" class="fa fa-chevron-up" aria-hidden=true></span></a>
		<!--a class="sm-fill nav-link disabled">Text</a-->
		<a class="sm-fill nav-link" href="../">Grafik</a>
		<a class="sm-fill nav-link" href="../../thumb/text/">Miniatur&shy;bilder</a>
		<a class="sm-fill nav-link" href="../../../../../../nascom/journal/pdf/83-05.pdf" download>PDF</a>
		<a class="sm-fill nav-link" href="../../../../../../datenschutzerklaerung/">Datenschutzerklärung</a>
		<a class="sm-fill nav-link" href="../../../../../../impressum/">Impressum</a>
	</nav>

	<!--bootstrap-->
	<script src="../../../../../../cdn/bootstrap/js/bootstrap.bundle.min.js"></script>
</body>

<!-- /navi-footer.php -->
</html>

<!-- /page.php -->