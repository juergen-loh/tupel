<!doctype html>
<html lang="de">

<!-- navi-head.php / $Date: 2023-03-11 15:22:20 +0100 (Sa, 11. Mrz 2023) $ -->
<head>
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<meta charset="utf-8">

	<link rel="shortcut icon" type="image/x-icon" href="../../../../../../nascom/nascom.ico">
	<link rel="icon" type="image/png" href="../../../../../../nascom/apple-touch-icon.png" sizes="32x32">
	<link rel="icon" type="image/png" href="../../../../../../nascom/apple-touch-icon.png" sizes="96x96">
	<link rel="apple-touch-icon" sizes="180x180" href="../../../../../../nascom/apple-touch-icon.png">

	<!--bootstrap-->
	<link rel="stylesheet" href="../../../../../../cdn/bootstrap/css/bootstrap.min.css">

	<!--font awesome-->
	<link rel="stylesheet" href="../../../../../../cdn/fontawesome/css/fontawesome.min.css">
	<link rel="stylesheet" href="../../../../../../cdn/fontawesome/css/solid.min.css">

	<link rel="stylesheet" type="text/css" href="../../../../../../style.css">
<!-- /navi-head.php -->

	<!-- page.php / $Date: 2024-06-30 12:05:40 +0200 (So, 30. Jun 2024) $ -->

	<title>Nascom Journal - März/April 1982 - Ausgabe 3/4</title>
	<!-- Sun, 30 Jun 2024 10:05:41 GMT -->
	<meta name="keywords" content="Nascom Journal, Nascom Computer, Nascom 1, Nascom 2">
<!-- navi-body.php -->
</head>

<body>
	<nav class="navbar navbar-expand-md navbar-light bg-light style-navbar-top" id="top">
	<div class="container-fluid">
		<a class="navbar-brand" href="https://jloh.de/">
			<img src="../../../../../../favicon.ico" width="32" height="32" alt="JL" title="Homepage von Jürgen Loh">
		</a>
		<button
			class="navbar-toggler"
			type="button"
			data-bs-toggle="collapse"
			data-bs-target="#navbarSupportedContent"
			aria-controls="navbarSupportedContent"
			aria-expanded="false"
			aria-label="Toggle navigation"
		>
			<span class="navbar-toggler-icon"></span>
		</button>
		<div class="collapse navbar-collapse robots-nocontent" id="navbarSupportedContent">
			<ul class="navbar-nav md-auto">
				<li class="nav-item">
					<a class="nav-link" href="../../../../../../z80-kit/">Z80-KIT</a>
				</li>
				<li class="nav-item">
					<a class="nav-link" href="../../../../../../nascom/1/">Nascom 1</a>
				</li>
				<li class="nav-item">
					<a class="nav-link active" href="../../../../../../nascom/">Nascom Journal</a>
				</li>
				<li class="nav-item">
					<a class="nav-link" href="../../../../../../nascom/magazines/issues/">Nascom Magazines</a>
				</li>
				<li class="nav-item">
					<a class="nav-link" href="../../../../../../pico/">PICO</a>
				</li>
				<li class="nav-item">
					<a class="nav-link" href="../../../../../../cpm-plus/">CP/M</a>
				</li>
				<li class="nav-item">
					<a class="nav-link" href="../../../../../../">Tupel BBS</a>
				</li>
			</ul>
		</div>
	</div>
	</nav>

	<div class="container" style="max-width: 750px; color: #000; padding: 0 15px 0; background-color: #FFF">

<!--********************************************************************************-->

<!-- /navi-body.php / $Date: 2024-06-30 12:05:40 +0200 (So, 30. Jun 2024) $ -->
<table class="style-table-zeropadding" style="width: 100%">
	<tr>
		<td>
			<h1 class="h1Navi">Nascom Journal</h1>
		</td>
		<td>&nbsp;&nbsp;</td>
		<td style="vertical-align:top">
			<h2 class="h2Navi"><span class="nowrap">März/April 1982 &middot;</span> <span class="nowrap">Ausgabe 3/4</span></h2>
		</td>
	</tr>
</table>

<div id="head"><!-- Navigation oben -->
<table class="robots-nocontent style-table-zeropadding" style="width: 100%">
	<tr>
		<td class="navi-button">
			<a style="display: block" href="../../23/text/" title="Seite zurück"><span class="mirror-horizontal fas fa-play" aria-hidden=true></span></a>
		</td>
		<td class="navi-button">
			<a style="display: block" href="../../01/text/" title="Erste Seite"><span class="fas fa-fast-backward" aria-hidden=true></span></a>
		</td>
		<td class="navi-button">
			<a style="display: block" href="../../../../82/02/01/text/" title="Heft zurück"><span class="fas fa-backward" aria-hidden=true></span></a>
		</td>
		<th class="navi-button">
			<a style="display: block" href="../../text/" title="Inhaltsverzeichnis">Seite 24 von 52</a>
		</th>
		<td class="navi-button">
			<a style="display: block" href="../../../../82/05/01/text/" title="Heft vor"><span class="fas fa-forward" aria-hidden=true></span></a>
		</td>
		<td class="navi-button">
			<a style="display: block" href="../../52/text/" title="Letzte Seite"><span class="fas fa-fast-forward" aria-hidden=true></span></a>
		</td>
		<td class="navi-button">
			<a style="display: block" href="../../25/text/" title="Seite vor"><span class="fas fa-play" aria-hidden=true></span></a>
		</td>
	</tr>
</table>
</div><!-- /Navigation oben -->

<!-- Die Seite -->
<div class="row" id="page"><div class="col-sm-12 hyphenate" style="border: 1px solid #000; padding-top: 1em; padding-bottom: 1em;">

<!-- 2(2) Spalten im Blocksatz: Start --><div class="style-multi-column-2 justify">

<h1 id="article1" class="donthyphenate">
Schnelle<br>Tastatur-Abfrage
</h1>
<h3>
von Josef Zeller
</h3>
<h4>
1)Problemstellung
</h4>
<p>
Die Tastaturabfrage und die Ermittlung des Zeichens ist beim Nascom
System der CPU uebertragen. Damit wird die CPU mit
&bdquo;Verwaltungsaufgaben belastet, die viel Zeit benoetigen. Diese
Zeitbelastung fuer die CPU faellt natuerlich nicht weiter auf, wenn der
Rechner darauf wartet, bis der Benutzer eine Taste drueckt. Bei
Programmen, die waehrend der Laufzeit die Tastatur abfragen, um z.B.
das Auflisten zu stoppen oder das Programm abzubrechen, nimmt die Zeit
fuer die Tastaturabfrage einen relativ grossen Teil der
Programmlaufzeit in Anspruch. Im folgenden soll eine Moeglichkeit
gezeigt werden, wie die Abfrage, ob eine Taste gedrueckt ist, rapide
verkuerzt werden kann.
</p>
<h4>
2)Tastaturhardware &ndash; Prinzip
</h4>
<p>
Die Tasten beim
Nascom&nbsp;1 sind in einer 8mal6 Matrix (8 Spalten und 6 Zeilen)
angeordnet. Am Anfang der Tastaturroutine setzt die CPU ueber &bdquo;KBD
Counter Reset&ldquo; die Zaehler auf der Tastaturplatine zurueck. Danach
werden ueber &bdquo;KBD Counter Clock&ldquo; die 8 Spalten der Matrix
jeweils einmal durch die CPU gepulst, d.h. die Leitungen (D0-D7 siehe
Originalschaltbild) werden jeweils einmal auf low gesetzt. Nachdem eine
Spalte getaktet wurde, fragt die CPU den Port 00 ab. In diesem
Port ist der Zustand der 6 Spalten angegeben. Wird z.B. die Taste
&bdquo;B&ldquo; gedrueckt, so wird beim Takten von Spalte D1 die Zeile S3
auf low gesetzt. Ist eines der Bits 0-5 auf low, erkennt die CPU, dass
eine Taste gedrueckt wurde, und ermittelt daraus das ASCII-Zeichen.
Nur um zu ermitteln, ob ueberhaupt eine Taste gedrueckt wurde,
benoetigt die CPU ca, 940 Taktzyklen.
</p>
<h4>
3)Ergebnis
</h4>
<p>
Es wurde also eine Moeglichkeit gesucht, diese Abfrage erheblich zu
verkuerzen. Die dazu benoetigte Hardwareaenderung ist minimal. Das
Programm benoetigt nur noch 124 Taktzyklen und ist damit ueber 7 mal
schneller als das Original. Der Assembler uebersetzt z.B. eine Quelle
mit 4,5 Bytes Quelltext statt in 32 sec. in 18 sec.
</p>
<!-- nowrap Start --><div class="style-nowrap">
<h4>
4)Hardware
</h4>
<p>
Benoetigt wird dazu ein <!-- External Link --><a href="https://www.zilog.com/docs/z80/ps0181.pdf" title="Externer Link: Z80 CTC" target="_blank" rel="noreferrer">CTC</a><!-- /External Link -->, durch den die Spalten gepulst werden, und
ein OR-Gatter,

<!-- 2 Spalten im Blocksatz: Spaltenwechsel -->

damit entweder der CTC oder die CPU den &bdquo;KBD Counter Clock&ldquo;
takten kann.
</p>
<!-- nowrap Ende --></div>
<h4>
5)Programm
</h4>
<p>
Das Programm EXTKBD wird anstatt der Nascom Monitorroutine aufgerufen.
Der CTC wird initialisiert und gibt alle 16 Takte einen Impuls aus. Die
CPU fragt den Zustand von Port 00 ab und kehrt, wenn keine Taste
gedrueckt wurde, ins Aufruferprogramm zurueck. Wurde eine Taste
gedrueckt, wird die Monitorroutine KBD aufgerufen und das Zeichen
ermittelt.
</p>
<h4>
6)Weiterentwicklung
</h4>
<p>
Eine interruptgesteuerte KBD-Routine ist bei mir ebenfalls im Einsatz.
Sie ist vom Programmaufwand etwas umfangreicher. Leider ist das
Programm noch nicht so ausgereift, um es zu veroeffentlichen. Sobald es
aber zuverlaessig funktioniert, wird es nachgeliefert.
</p>

<!-- Kasten über ganze Spalte: Start --><div style="border-style: solid; padding: 10px; border-width: 2px;  width: 100%; ">
<img class="img-fluid mx-auto d-block " src="../../Image-24-1.jpeg" alt="" width="251" height="133"><br>
<img class="img-fluid mx-auto d-block " src="../../Image-24-2.jpeg" alt="" width="217" height="36">
<!-- Kasten: Ende --></div>
<br>
<img class="img-fluid" src="../../Image-24-3.jpeg" alt="" width="358" height="327">
<!-- 2 Spalten: Ende --></div>

</div></div>
<!-- /Die Seite -->

<!-- Navigation unten -->
<table class="robots-nocontent style-table-zeropadding" style="width: 100%">
	<tr>
		<td class="navi-button">
			<a style="display: block" href="../../23/text/" title="Seite zurück"><span class="mirror-horizontal fas fa-play" aria-hidden=true></span></a>
		</td>
		<td class="navi-button">
			<a style="display: block" href="../../01/text/" title="Erste Seite"><span class="fas fa-fast-backward" aria-hidden=true></span></a>
		</td>
		<td class="navi-button">
			<a style="display: block" href="../../../../82/02/01/text/" title="Heft zurück"><span class="fas fa-backward" aria-hidden=true></span></a>
		</td>
		<th class="navi-button">
			<a style="display: block" href="../../text/" title="Inhaltsverzeichnis">Seite 24 von 52</a>
		</th>
		<td class="navi-button">
			<a style="display: block" href="../../../../82/05/01/text/" title="Heft vor"><span class="fas fa-forward" aria-hidden=true></span></a>
		</td>
		<td class="navi-button">
			<a style="display: block" href="../../52/text/" title="Letzte Seite"><span class="fas fa-fast-forward" aria-hidden=true></span></a>
		</td>
		<td class="navi-button">
			<a style="display: block" href="../../25/text/" title="Seite vor"><span class="fas fa-play" aria-hidden=true></span></a>
		</td>
	</tr>
</table>
<!-- /Navigation unten -->

<!-- navi-footer.php / $Date: 2023-03-11 15:22:20 +0100 (Sa, 11. Mrz 2023) $ -->

<!--********************************************************************************-->

	</div>

	<nav class="nav flex-column flex-md-row style-navbar-bottom robots-nocontent"> <!--nav-pills-->
		<a class="sm-fill nav-link" href="#top"><span title="Nach oben" class="fa fa-chevron-up" aria-hidden=true></span></a>
		<!--a class="sm-fill nav-link disabled">Text</a-->
		<a class="sm-fill nav-link" href="../">Grafik</a>
		<a class="sm-fill nav-link" href="../../thumb/text/">Miniatur&shy;bilder</a>
		<a class="sm-fill nav-link" href="../../../../../../nascom/journal/pdf/82-03.pdf" download>PDF</a>
		<a class="sm-fill nav-link" href="../../../../../../datenschutzerklaerung/">Datenschutzerklärung</a>
		<a class="sm-fill nav-link" href="../../../../../../impressum/">Impressum</a>
	</nav>

	<!--bootstrap-->
	<script src="../../../../../../cdn/bootstrap/js/bootstrap.bundle.min.js"></script>
</body>

<!-- /navi-footer.php -->
</html>

<!-- /page.php -->